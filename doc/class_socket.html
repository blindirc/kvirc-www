<html>
<head>
<title>socket class</title>
<style type="text/css">
body {
 font-size: 10pt;
 margin-left: 8px;
 margin-right: 8px;
 margin-top: 6px;
 margin-bottom: 6px;
 font-family:Verdana,Helvetica,Arial;
}
table, td, tr {
 font-size: 10pt;
 font-family:Verdana,Helvetica,Arial;
 color: #3c3c3c;
}
td {
 padding: 6px;
}
a:link {
 text-decoration: none;
 color: #2883e2;
}
a:visited {
 text-decoration: none;
 color: #6856cc;
}
a:hover {
 text-decoration: underline;
 color: #1873d2;
}
a:active {
 text-decoration: underline;
 color: #1873d2;
}
.title-table-cell {
 border-top-left-radius: 5px;
 border-top-right-radius: 5px;
 background-color: #BEBEF0;
 background: linear-gradient(#B5E1FC,#4E94D2);
}
.title-text {
 font-family:Verdana,Helvetica,Arial;
 font-size: 18pt;
 font-weight: bold;
 padding-bottom: 3px;
 color: #ffffff;
 text-shadow: 2px 2px 2px rgba(88,88,88,1);
}
.title-secondary-text {
 font-family:Verdana,Helvetica,Arial;
 font-size: 11pt;
 padding-top: 3px;
 color: #d0d0d0;
 text-shadow: 1px 1px 1px rgba(88,88,88,1);
}
.subtitle-table-cell {
 background-color: #cccccc;
}
.subtitle-text {
 font-family:Verdana,Helvetica,Arial;
 font-size: 11pt;
 color: #000000;
 text-shadow: 1px 1px 1px rgba(110,110,110,1);
}
.subsubtitle-table-cell {
 background-color: #dadada;
}
.subsubtitle-text {
 font-family:Verdana,Helvetica,Arial;
 font-size: 10pt;
 color: #4e4e4e;
}
.syntax-text {
 font-family:"Lucida Console", Monaco, monospace, "Courier New";
 font-size: 10pt;
 font-weight: bold;
 white-space: pre;
 color: #800000;
}
.example-box {
 font-family:"Lucida Console", Monaco, monospace, "Courier New";
 font-size: 10pt;
 white-space: pre;
 background-color: #f5f5f5;
 border: 1px solid #d5d5d5;
 color: #800000;
 padding: 10px;
 margin-top: 6px;
 margin-bottom: 6px;
}
.example-box a:link {
 color: #600030;
}
.example-box a:visited {
 color: #600030;
}
.example-box a:hover {
 color: #ff0020;
}
.example-box a:active {
 color: #ff0020;
}
.comment-text {
 color: #578A57;
}
.comment-text a:link {
 color: #578A57;
}
.comment-text a:visited {
 color: #578A57;
}
.comment-text a:hover {
 color: #376A47;
}
.comment-text a:active {
 color: #376A47;
}
.example-paren {
 color: #8A7000;
}
.example-bracket {
 color: #9C7914;
}
.example-oper {
 color: #9C7914;
}
.example-variable {
 color: #AB6332;
}
.comment-text .example-variable {
 color: #578A57;
}
.comment-text .example-oper {
 color: #578A57;
}
.comment-text .example-paren {
 color: #578A57;
}
.comment-text .example-bracket {
 color: #578A57;
}
.switch-table {
 width: 100%;
 border-collapse: collapse;
}
.switch-title-table-cell {
 font-family:"Lucida Console", Monaco, monospace, "Courier New";
 font-size: 10pt;
 color: #670000;
 background-color: #e0e0e0;
}
.switch-body-table-cell {
}
.footer {
 border-top: 1px solid #a2a2a2;
 color: #a2a2a2;
 margin-top: 8px;
 padding-top: 4px;
 font-style: italic;
 font-size: 8pt;
}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
</head>
<body bgcolor="#FFFFFF" text="#000000">
<table width="100%" cellpadding="1" cellspacing="0" border="0">
 <tr>
  <td align="left" bgcolor="#FFFFFF">
    <a href="index.html"><img src="helplogoleft.png" iorder="0"></a>
  </td>
  <td align="right" bgcolor="#FFFFFF">
    <img src="helplogoright.png">
  </td>
 </tr>
</table>
<table width="100%" cellpadding="3" cellspacing="0" border="0">
  <tr>
    <td class='title-table-cell'>
      <div class='title-text'>socket class</div>      <div class='title-secondary-text'>A Ipv4/Ipv6 TCP socket</div>    </td>
  </tr>
  <tr>
    <td class='subtitle-table-cell'><div class='subtitle-text'>Inherits</div></td>
  </tr>
  <tr bgcolor="#EAEAEA">
    <td><a href="class_object.html">object</a></td>
  </tr>
  <tr>
    <td class='subtitle-table-cell'><div class='subtitle-text'>Description</div></td>
  </tr>
  <tr bgcolor="#EAEAEA">
    <td>This class provides a standard TCP/IP socket functionality.<br>
It can be used either for connecting to a remote host or to listening for incoming connections.<br>
If the KVIrc executable has been compiled with the IPV6 protocol support, this socket also supports it.<br>
</td>
  </tr>
  <tr>
    <td class='subtitle-table-cell'><div class='subtitle-text'>Functions</div></td>
  </tr>
  <tr bgcolor="#EAEAEA">
    <td>
      <table bgcolor="#E0E0E0">
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="&lt;integer or string&gt; status">&lt;integer or string&gt; $status(&lt;asString:boolean&gt;)</a></font></b></code></td></tr>
<tr><td>Returns the status of the socket :<br> 0=Unconnected 1=HostLookUp 2=Connecting<br> 3=Connected<br> 4=Bound<br> 5=Closing<br> 6=Listening</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="connect">$connect(&lt;host&gt;,&lt;port&gt;)</a></font></b></code></td></tr>
<tr><td>Attempts a connection to &lt;host&gt; on port &lt;port&gt;.<br> &lt;host&gt; can be a numeric internet address (either Ipv4 or Ipv6 (if supported)) or a hostname.<br> If a hostname is used, a DNS lookup is performed (the socket enters the "dns call" state).<br> This function returns 1 if the connect attempt can be successfully initiated, 0 otherwise.<br> In fact, this function returns 0 only if the supplied &lt;port&gt; parameter is invalid or the socket is in an incoherent state (already connected or listening): for a newly created socket and with a valid &lt;port&gt; number you can safely ignore the return value.<br> Please note that the connection is asynchronous: when this function returns the socket is NOT connected: it has just initiated the connect attempt and you will be notified of the attempt result by an asynchronous event call: in case of failure, $connectFailedEvent() will be called, in case of succes, $connectEvent() will be called.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="listen">$listen([&lt;port&gt;[,&lt;interface&gt;[,&lt;force_ipv6&gt;]]])</a></font></b></code></td></tr>
<tr><td>Attempts to listen on the specified &lt;port&gt; and &lt;interface&gt;.<br> If &lt;port&gt; is not passed it is assumed to be 0, if &lt;interface&gt; is not passed, it is assumed to be "any interface" (INADDR_ANY).<br> Port 0 means that the kernel should choose a "random" port to listen on.<br> If the &lt;interface&gt; is recognized as IPV6 address, and IPV6 is supported, the socket listens in IPV6 mode. If &lt;interface&gt; is an empty string and &lt;force_ipv6&gt; is 1 the socket listens on "any ipv6 interface".<br> This function returns '1' in case of success and '0' in case of failure.<br> On some systems listening in the IPV6 namespace allows to accept also IPV4 connections (this includes linux but not windows afaik).<br> When an incoming connection will arrive, $incomingConnectionEvent() will be called.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="connectedEvent">$connectedEvent()</a></font></b></code></td></tr>
<tr><td>This function is called when a connection attempt has been successfully completed. The socket is actually connected to <a href="class_socket.html#remoteip">$remoteip</a>() on <a href="class_socket.html#remoteport">$remoteport</a>(). You can start writing data and you may expect <a href="class_socket.html#dataavailableevent">$dataavailableevent</a>() to be triggered.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="incomingConnectionEvent">$incomingConnectionEvent(&lt;socket:h_object&gt;)</a></font></b></code></td></tr>
<tr><td>This function is called when an incoming connection arrives over a socket in listening state.<br> You must return 1 if you to terminad this incoming connectioncall <a href="class_socket.html#accept">$accept</a>() passing a newly created socket object to accept and handle the connection.<br> If you don't call <a href="class_socket.html#accept">$accept</a>() the incoming connection will be automatically terminated.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="connectFailedEvent">$connectFailedEvent(&lt;reason&gt;)</a></font></b></code></td></tr>
<tr><td>This function is called when a connection attempt fails for some reason. &lt;reason&gt; contains the error string.<br> This function may be called only between a call to <a href="class_socket.html#connect">$connect</a>() and the <a href="class_socket.html#connectevent">$connectevent</a>().</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="disconnectEvent">$disconnectEvent([error])</a></font></b></code></td></tr>
<tr><td>This function is called when a connection is terminated either cleanly or because of an error.<br> [error] is an empty string in case of a "clean" termination (connection closed by the remote host) or is a message describing the socket error that caused the connection to be interrupted.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="dataAvailableEvent">$dataAvailableEvent(&lt;data_length&gt;)</a></font></b></code></td></tr>
<tr><td>This function is called when some data is available to be read: the &lt;data_length&gt; parameter specifies the length of the available data in bytes.<br> You can use one of the $read* functions to obtain the data</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="read">$read(&lt;length&gt;[,&lt;hobject&gt;])</a></font></b></code></td></tr>
<tr><td>Reads at most &lt;length&gt; bytes of data from the socket. If &lt;length&gt; is anything "outside" the available data range (&lt;length&gt; &lt; 0 or &lt;length&gt; &gt; available_data_length), this function returns all the available data.<br> By default this function can deal ascii data only: NULL characters are transformed to ASCII characters 255. You can pass a <a href="class_memorybuffer.html">memorybuffer</a> object to read binary data.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="write">$write(&lt;data, array,files or hobject&gt;[,length])</a></font></b></code></td></tr>
<tr><td>Writes &lt;data&gt; to the socket.<br> This function can deal with binary data passing  a <a href="class_memorybuffer.html">memorybuffer</a> object<br> Please note that when this function finishes it does not mean that the data has reached the remote end.<br> Basically it does not even mean that the data has been sent to the remote host.<br> The data is enqueued for sending and will be sent as soon as possible.<br> Using an array you can pass bytes or data string like this: @$write($array($(0xff),$(0xff),$(0xff),$(0xff),"This is an example")); If you're going to <a href="cmd_delete.html">delete</a> this object just after the $write call, you should call <a href="class_socket.html#close">$close</a>() just before <a href="cmd_delete.html">delete</a> to ensure the data delivery.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="close">$close()</a></font></b></code></td></tr>
<tr><td>Resets this socket state: kills any pending or active connection. After a close() call the socket may be used for a new connection.<br> If there is an active connection, there is a last attempt to flush the pending outgoing data.<br> You don't need to call $close() if you <a href="cmd_delete.html">delete</a> the socket: KVIrc will reset the socket state automatically and free the memory. But if you want to ensure data delivery after a $write call sequece and just before a <a href="cmd_delete.html">delete</a>, $close() is the only chance to do it.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="remoteIp">$remoteIp()</a></font></b></code></td></tr>
<tr><td>Returns the IP address of the remote end of this socket.<br> The return value is meaningful only if the socket is in connected or connecting state.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="setProtocol">$setProtocol(&lt;protocol&gt;)</a></font></b></code></td></tr>
<tr><td>Let KVIrc use TCP or UDP protocol</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="remotePort">$remotePort()</a></font></b></code></td></tr>
<tr><td>Returns the port of the remote end of this socket.<br> The return value is meaningful only if the socket is in connected or connecting state.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="localIp">$localIp()</a></font></b></code></td></tr>
<tr><td>Returns the IP address of the local end of this socket.<br> The return value is meaningful only if the socket is in connected, listening or connecting state.</td></tr>
<tr bgcolor="#D5D5D5"><td><code><b><font color=""><a name="localPort">$localPort()</a></font></b></code></td></tr>
<tr><td>Returns the port of the local end of this socket.<br> The return value is meaningful only if the socket is in connected, listening or connecting state.</td></tr>
      </table>
    </td>
  </tr>
  <tr>
    <td class='subtitle-table-cell'><div class='subtitle-text'>Examples</div></td>
  </tr>
  <tr bgcolor="#EAEAEA">
    <td><div class="example-box">// Server socket: listen 8080 port and answer to requests <span class="example-paren">(</span>multi-threaded<span class="example-paren">)</span>
class<span class="example-paren">(</span>"webserver","socket"<span class="example-paren">)</span>
<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;function incomingConnectionEvent<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;    // incoming connection socket passed by the framework
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="example-variable">%socket</span> = $0
&nbsp;&nbsp;&nbsp;&nbsp;    debug "Webserver incoming Conection from: <span class="example-variable">%socket</span>-&gt;$remoteIp : <span class="example-variable">%socket</span>-&gt;$remotePort"
&nbsp;&nbsp;&nbsp;&nbsp;    <span class="example-variable">%socket</span>-&gt;$write<span class="example-paren">(</span>"HTTP/1.0 200 OK\n\n&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;KVIrc Webserver&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;\n"<span class="example-paren">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;    // tells KVIrc no need this socket anymore
&nbsp;&nbsp;&nbsp;&nbsp;    return $true<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;function constructor<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;    debug listen @$listen<span class="example-paren">(</span>8080, "127.0.0.1"<span class="example-paren">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
<span class="example-bracket">}</span>
// finally start webserver
<span class="example-variable">%WebS</span> = $new<span class="example-paren">(</span>webserver<span class="example-paren">)</span>
</div>
<div class="example-box">// Client socket - go to google and grab request header<br>
class<span class="example-paren">(</span>"httprequest","socket"<span class="example-paren">)</span>
<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;function errorEvent<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// the connection to the server failed
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug  "Connection failed: "$0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $$
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;function disconnectedEvent<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// connection has been closed
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug  "Connection is closed"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $$
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;function destructor<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// if the socket is still open close it
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if<span class="example-paren">(</span>@$status<span class="example-paren">()</span> == "Connected"<span class="example-paren">)</span> @$close<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;function stateChangedEvent<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug socket state $0
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;function dataAvailableEvent<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// reading the received data
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug reading $0 bytes
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-variable">%newdata</span>  = @$read<span class="example-paren">(</span>$0<span class="example-paren">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug data:  <span class="example-variable">%newdata</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// close and delete the socket
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@$close<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $$
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;function constructor<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// connect to the server
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@$connect<span class="example-paren">(</span>"www.google.com",80<span class="example-paren">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
&nbsp;&nbsp;&nbsp;&nbsp;function connectedEvent<span class="example-paren">()</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">{</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// connection is complete
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// send a request to receive the headers only from http://www.google.com/
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug connected
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug written bytes @$write<span class="example-paren">(</span>"HEAD / HTTP/1.1\r\nHost: www.google.de\r\nConnection: Close\r\nUser-Agent: KVIrc socket\r\n\r\n"<span class="example-paren">)</span> on socket;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="example-bracket">}</span>
<span class="example-bracket">}</span>
<span class="example-variable">%Temp</span> = $new<span class="example-paren">(</span>httprequest<span class="example-paren">)</span>
</div>
</td>
  </tr>
</table>
<hr><a href="index.html">Index</a>, <a href="doc_class_index_all.html">Object Classes</a>
<div class='footer'>KVIrc 4.3.2.git-5292-gb397f4d Documentation - generated by universal at Wed Sep  9 13:23:28 2015</div>
</body>
</html>
